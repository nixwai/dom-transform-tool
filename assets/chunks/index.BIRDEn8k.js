const U=/(matrix3?d?)\((.+)\)/;function V(e){return e?e==="none"||e==="auto"?1/0:Number(e.replace("px","")):0}function Z(e,a){var c;const t={width:0,height:0,aspectRatio:0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,offsetX:0,offsetY:0,transform:{name:"matrix",values:[1,0,0,1,0,0],beforeTranslateValueStr:"1,0,0,1",afterTranslateValueStr:"",scaleX:1,scaleY:1,rotate:0,originRelativeX:.5,originRelativeY:.5},pointerDir:{x:1,y:1}};if(!a)return t;const s=window.getComputedStyle(a,null),d=s.transform.match(U);if(t.transform.name=(d==null?void 0:d[1])||"matrix",t.transform.values=((c=d==null?void 0:d[2])==null?void 0:c.split(",").map(Number))||[1,0,0,1,0,0],t.transform.values.length>6){t.transform.beforeTranslateValueStr=`${t.transform.values.slice(0,12).join(",")},`,t.transform.afterTranslateValueStr=`,${t.transform.values.slice(15).join(",")}`,t.offsetX=t.transform.values[12],t.offsetY=t.transform.values[13];const r=t.transform.values[0],u=t.transform.values[1],m=t.transform.values[4],Y=t.transform.values[5];t.transform.scaleX=P(Math.sqrt(r*r+u*u)),t.transform.scaleY=P(Math.sqrt(m*m+Y*Y)),t.transform.rotate=P((Math.atan2(u,r)*180/Math.PI+360)%360)}else{t.transform.beforeTranslateValueStr=`${t.transform.values.slice(0,4).join(",")},`,t.transform.afterTranslateValueStr="",t.offsetX=t.transform.values[4],t.offsetY=t.transform.values[5];const r=t.transform.values[0],u=t.transform.values[1],m=t.transform.values[2],Y=t.transform.values[3];t.transform.scaleX=P(Math.sqrt(r*r+u*u)),t.transform.scaleY=P(Math.sqrt(m*m+Y*Y)),t.transform.rotate=P((Math.atan2(u,r)*180/Math.PI+360)%360)}if(e.offset==="position")t.offsetX=V(s.left),t.offsetY=V(s.top);else if(e.offset==="translate")if(!s.translate||s.translate==="none")t.offsetX=0,t.offsetY=0;else{const r=s.translate.split(" ");t.offsetX=V(r[0]),t.offsetY=V(r[1])}else t.transform.values.length>6?(t.offsetX=t.transform.values[12],t.offsetY=t.transform.values[13]):(t.offsetX=t.transform.values[4],t.offsetY=t.transform.values[5]);t.width=V(s.width),t.height=V(s.height),t.aspectRatio=t.height!==0?t.width/t.height:1;const o=["maxWidth","maxHeight","minWidth","minHeight"],h=o.map(r=>s[r]);if(h.some(r=>r.includes("%"))){const r=window.getComputedStyle(a.parentNode,null),u=[r.width,r.height].map(V);r.boxSizing==="border-box"&&(u[0]=u[0]-V(r.paddingLeft)-V(r.paddingRight),u[1]=u[1]-V(r.paddingTop)-V(r.paddingBottom)),h.map((m,Y)=>m.includes("%")?u[Y%2]*Number(m.replace("%",""))/100:V(m)).forEach((m,Y)=>t[o[Y]]=m)}else h.map(V).forEach((r,u)=>t[o[u]]=r);if(e.lockAspectRatio){const r=t.minHeight*t.aspectRatio;r>t.minWidth?t.minWidth=r:t.minHeight=t.minWidth/t.aspectRatio}const n=s.transformOrigin.split(" "),g=a.style.transformOrigin,x=g.split(" "),i=Array.isArray(e.originIsAbsolute)?e.originIsAbsolute:[e.originIsAbsolute,e.originIsAbsolute],f=J(i[0],n[0],x[0],g.includes("left")||g.includes("right")),l=J(i[1],n[1],x[1],g.includes("top")||g.includes("bottom"));if(t.transform.originRelativeX=f/t.width,t.transform.originRelativeY=l/t.height,e.event){const r=a.getBoundingClientRect(),u=r.left+r.width/2,m=r.top+r.height/2,Y=e.event.clientX-u,S=e.event.clientY-m,A=-t.transform.rotate*Math.PI/180,p=Y*Math.cos(A)-S*Math.sin(A),k=Y*Math.sin(A)+S*Math.cos(A);t.pointerDir.x=p>0?1:-1,t.pointerDir.y=k>0?1:-1}return t}function J(e,a,t,s){return e===!0?0:e===!1||!t||t.includes("%")||t.includes("center")||s?V(a):0}function P(e){return Math.round(e*100)/100}function _(e,a,t){const{name:s,beforeTranslateValueStr:d,afterTranslateValueStr:o}=t.transform,h=e.deref(),n=i=>!h||a.customControl?i:(...f)=>{const l=i(...f);for(const c in l)h.style[c]=l[c];return l},g=n((i,f)=>({[f]:`${i}px`}));let x=()=>({});return a.offset==="position"?x=n((i,f)=>({left:`${i}px`,top:`${f}px`})):a.offset==="transform"?x=n((i,f)=>({transform:`${s}(${d}${i},${f}${o})`})):a.offset==="translate"&&(x=n((i,f)=>({translate:`${i}px ${f}px`}))),{setStyleWidthOrHeight:g,setStyleOffset:x}}function j(e){const a=e();return(t,s,d,o)=>{const{getOffsetNegative:h,getOffsetPositive:n}=a(t,s,d);return o>0?n(t,s,d):h(t,s,d)}}const N=()=>({offsetCurrentAxis:0,offsetAnotherAxis:0});function tt(e,a){if(!e.offset)return{getForwardMoveOffset:N,getBackwardMoveOffset:N,getBothMoveOffset:N};const{width:t,height:s,offsetX:d,offsetY:o,transform:h,minWidth:n,minHeight:g}=a,{rotate:x,originRelativeX:i,originRelativeY:f,scaleX:l,scaleY:c}=h,r=x*Math.PI/180,u=Math.cos(r),m=Math.sin(r),Y={x:{v1:(l-1)*i,v2:(l-1)*(1-i)},y:{v1:(c-1)*f,v2:(c-1)*(1-f)}},S={x:{v1:l*(u-1)*i,v2:l*(u-1)*(1-i)},y:{v1:c*(u-1)*f,v2:c*(u-1)*(1-f)}},A={x:{v1:l*m*i,v2:l*m*(1-i)},y:{v1:c*m*f,v2:c*m*(1-f)}},p=e.crossAxis?{x:{originCos:d+t+t*(l*u-1)*(1-2*i),minCos:n*l*u,originSin:t*(l*m)*(1-2*i),minSin:n*l*m},y:{originCos:o+s+s*(c*u-1)*(1-2*f),minCos:g*c*u,originSin:s*(c*m)*(1-2*f),minSin:g*c*m}}:{x:{originCos:0,minCos:0,originSin:0,minSin:0},y:{originCos:0,minCos:0,originSin:0,minSin:0}},k={x:d,y:o},$=j(()=>{const z=(C,w)=>{const X=C*Y[w].v1,v=C*S[w].v1,y=C*A[w].v1;return{offsetCurrentAxis:k[w]+X+v,offsetAnotherAxis:y}};let W=N;if(e.crossAxis){const C={x:p.x.originCos+p.x.minCos,y:p.y.originCos+p.y.minCos},w={x:p.x.originSin+p.x.minSin,y:p.y.originSin+p.y.minSin};W=(X,v)=>{const y=X*Y[v].v2,M=X*S[v].v2,O=X*A[v].v2;return{offsetCurrentAxis:C[v]+X+y+M,offsetAnotherAxis:w[v]+O}}}return()=>({getOffsetPositive:z,getOffsetNegative:W})}),I=j(()=>{const z=(C,w)=>{const X=C*Y[w].v2,v=C*S[w].v2,y=C*A[w].v2;return{offsetCurrentAxis:k[w]+C+X+v,offsetAnotherAxis:y}};let W=N;if(e.crossAxis){const C={x:p.x.originCos-p.x.minCos,y:p.y.originCos-p.y.minCos},w={x:p.x.originSin-p.x.minSin,y:p.y.originSin-p.y.minSin};W=(X,v)=>{const y=X*Y[v].v1,M=X*S[v].v1,O=X*A[v].v1;return{offsetCurrentAxis:C[v]+y+M,offsetAnotherAxis:w[v]+O}}}return()=>({getOffsetPositive:z,getOffsetNegative:W})}),T=j(()=>{const z={x:(l-1)*(i-.5),y:(c-1)*(f-.5)},W={x:l*(u-1)*(i-.5),y:c*(u-1)*(f-.5)},C={x:l*m*(i-.5),y:c*m*(f-.5)},w=e.crossAxis?{x:d+t-2*t*(l*u-1)*(i-.5),y:o+s-2*s*(c*u-1)*(f-.5)}:{x:0,y:0},X=e.crossAxis?{x:-2*t*(l*m)*(i-.5),y:-2*s*(c*m)*(f-.5)}:{x:0,y:0};return(v,y,M)=>{const O=M*v/2,b=M*v*z[y],D=M*v*W[y],H=M*v*C[y],R=b+D-O,B=H;return{getOffsetPositive:()=>({offsetCurrentAxis:k[y]+R,offsetAnotherAxis:B}),getOffsetNegative:()=>({offsetCurrentAxis:w[y]-R,offsetAnotherAxis:X[y]-B})}}});return{getForwardMoveOffset:$,getBackwardMoveOffset:I,getBothMoveOffset:T}}const K=.5;function et(e,a){var C,w;const{width:t,height:s,aspectRatio:d,offsetX:o,offsetY:h,maxWidth:n,minWidth:g,maxHeight:x,minHeight:i}=a,f=e.direction||"all",l=f.includes("left"),c=f.includes("right"),r=f.includes("top"),u=f.includes("bottom"),m={x:0,y:0,dirX:l===c?0:c?1:-1,dirY:r===u?0:u?1:-1},Y={x:t,y:s},S=(X,v)=>{m[v]=X-Y[v],Y[v]=X};let A=(((C=e.grid)==null?void 0:C[0])||K)*(m.dirX?1:2),p=(((w=e.grid)==null?void 0:w[1])||K)*(m.dirY?1:2);e.lockAspectRatio&&(e.event||e.distanceX?p=A/d:A=p*d);const k={x:{originValue:t,originOffset:o,minValue:t-Math.floor((t-g)/A)*A,maxDistance:Math.floor((n-t)/A)*A,minDistance:Math.ceil((g-t)/A)*A,gridDistance:A},y:{originValue:s,originOffset:h,minValue:s-Math.floor((s-i)/p)*p,maxDistance:Math.floor((x-s)/p)*p,minDistance:Math.ceil((i-s)/p)*p,gridDistance:p}};let $;if(e.crossAxis){const X={x:2*k.x.minValue,y:2*k.y.minValue},v={x:Math.floor((n+t)/A)*A,y:Math.floor((n+s)/p)*p};$=(y,M,O,b)=>{const{maxDistance:D,minDistance:H,gridDistance:R}=k[O],B=Math.round((M-y)/R)*R,F=B*b;if(F<H){let q=B-b*X[O];return-b*q>v[O]&&(q=-b*v[O]),q}return F>D?D*b:B}}else $=(X,v,y,M)=>{const{maxDistance:O,minDistance:b,gridDistance:D}=k[y],H=Math.round((v-X)/D)*D,R=H*M;return R<b?b*M:R>O?O*M:H};const{getForwardMoveOffset:I,getBackwardMoveOffset:T,getBothMoveOffset:z}=tt(e,a),W=e.offset?X=>Math.abs(X):(X,v)=>X>v?X:v;return{moveDistance:m,resizingForward:(X,v,y)=>{const{originValue:M,minValue:O}=k[y],b=$(X,v,y,1),D=M+b,{offsetCurrentAxis:H,offsetAnotherAxis:R}=I(b,y,1,D),B=W(D,O);return S(B,y),{value:B,offset:H,otherOffset:R}},resizingBackward:(X,v,y)=>{const{originValue:M,minValue:O}=k[y],b=$(X,v,y,-1),D=M-b,{offsetCurrentAxis:H,offsetAnotherAxis:R}=T(b,y,-1,D),B=W(D,O);return S(B,y),{value:B,offset:H,otherOffset:R}},resizingBoth:(X,v,y,M=1)=>{const{originValue:O,minValue:b}=k[y],D=$(2*X,2*v,y,M),H=O+M*D,{offsetCurrentAxis:R,offsetAnotherAxis:B}=z(D,y,M,H),F=W(H,b);return S(F,y),{value:F,offset:R,otherOffset:B}}}}function st(e){const a=new WeakRef(e.target),t=Z(e,a.deref()),{setStyleWidthOrHeight:s,setStyleOffset:d}=_(a,e,t),{moveDistance:o,resizingForward:h,resizingBackward:n,resizingBoth:g}=et(e,t);return{targetRef:a,options:e,domAttrs:t,moveDistance:o,setStyleWidthOrHeight:s,setStyleOffset:d,resizingForward:h,resizingBackward:n,resizingBoth:g}}function E(e,a,t){var s,d;(d=(s=e.options).callback)==null||d.call(s,a,t)}function Q(e,a,t,s){const{options:d,resizingBackward:o,resizingForward:h,resizingBoth:n}=e;switch(d.direction){case"left":a(e,o);break;case"right":a(e,h);break;case"left-right":a(e,n);break;case"top":t(e,o);break;case"bottom":t(e,h);break;case"top-bottom":t(e,n);break;case"left-top":s(e,o,o);break;case"right-top":s(e,h,o);break;case"left-bottom":s(e,o,h);break;case"right-bottom":s(e,h,h);break;case"left-bottom-right":s(e,n,h);break;case"left-top-right":s(e,n,o);break;case"top-left-bottom":s(e,o,n);break;case"top-right-bottom":s(e,h,n);break;case"all":s(e,n,n);break}}function nt(e){!e.options.distanceX&&!e.options.distanceY||Q(e,it,ot,rt)}function it(e,a){const{setStyleWidthOrHeight:t,setStyleOffset:s,moveDistance:d}=e,{distanceX:o=0}=e.options,{width:h,offsetY:n}=e.domAttrs,g=a===e.resizingBackward?-1:1,{value:x,offset:i,otherOffset:f}=a(h,h+g*o,"x");if(!d.x)return;const l=n+f,c=t(x,"width"),r=s(i,l);E(e,{width:x,offsetX:i,offsetY:l},{...c,...r})}function ot(e,a){const{setStyleWidthOrHeight:t,setStyleOffset:s,moveDistance:d}=e,{distanceY:o=0}=e.options,{height:h,offsetX:n}=e.domAttrs,g=a===e.resizingBackward?-1:1,{value:x,offset:i,otherOffset:f}=a(h,h+g*o,"y");if(!d.y)return;const l=n-f,c=t(x,"height"),r=s(l,i);E(e,{height:x,offsetX:l,offsetY:i},{...c,...r})}function rt(e,a,t){const{setStyleWidthOrHeight:s,setStyleOffset:d,moveDistance:o}=e,{lockAspectRatio:h,distanceX:n=0,distanceY:g=0}=e.options,{width:x,height:i,aspectRatio:f}=e.domAttrs,l=c=>{const r=a===e.resizingBackward?-1:1,u=t===e.resizingBackward?-1:1,{value:m,offset:Y,otherOffset:S}=a(x,x+r*c.distanceX,"x"),{value:A,offset:p,otherOffset:k}=t(i,i+u*c.distanceY,"y");if(!o.x&&!o.y||h&&(!o.x||!o.y))return;const $=Y-k,I=p+S,T=s(m,"width"),z=s(A,"height"),W=d($,I);E(e,{width:m,height:A,offsetX:$,offsetY:I},{...T,...z,...W})};if(h)if(n){let c=!o.dirX&&o.dirY?2:1;c=o.dirX&&!o.dirY?.5:c,l({distanceX:n,distanceY:n/f*c})}else{let c=!o.dirX&&o.dirY?.5:1;c=o.dirX&&!o.dirY?2:c,l({distanceX:g*f*c,distanceY:g})}else l({distanceX:n,distanceY:g})}function at(e){e.options.event&&Q(e,ft,ct,lt)}function ft(e,a){const{setStyleWidthOrHeight:t,setStyleOffset:s,moveDistance:d}=e,{offsetY:o,pointerDir:h}=e.domAttrs;L(e,({startX:n,endX:g})=>{const{value:x,offset:i,otherOffset:f}=a(n,g,"x",h.x);if(!d.x)return;const l=o+f,c=t(x,"width"),r=s(i,l);E(e,{width:x,offsetX:i,offsetY:l},{...c,...r})})}function ct(e,a){const{setStyleWidthOrHeight:t,setStyleOffset:s,moveDistance:d}=e,{offsetX:o,pointerDir:h}=e.domAttrs;L(e,({startY:n,endY:g})=>{const{value:x,offset:i,otherOffset:f}=a(n,g,"y",h.y);if(!d.y)return;const l=o-f,c=t(x,"height"),r=s(l,i);E(e,{height:x,offsetX:l,offsetY:i},{...c,...r})})}function lt(e,a,t){const{setStyleWidthOrHeight:s,setStyleOffset:d,moveDistance:o,options:{lockAspectRatio:h}}=e,{aspectRatio:n,pointerDir:g}=e.domAttrs,x=i=>{const{value:f,offset:l,otherOffset:c}=a(i.startX,i.endX,"x",g.x),{value:r,offset:u,otherOffset:m}=t(i.startY,i.endY,"y",g.y);if(!o.x&&!o.y||h&&(!o.x||!o.y))return;const Y=l-m,S=u+c,A=s(f,"width"),p=s(r,"height"),k=d(Y,S);E(e,{width:f,height:r,offsetX:Y,offsetY:S},{...A,...p,...k})};if(h){let i=a===t?1:-1;const f=!o.dirX,l=!o.dirY;(f||l)&&(l?f?i=g.x*g.y:i=-i*o.dirX*g.y/2:i=-i*o.dirY*g.x*2),L(e,({startX:c,endX:r})=>{const u=i*c/n,m=i*r/n;x({startX:c,startY:u,endX:r,endY:m})})}else L(e,({startX:i,endX:f,startY:l,endY:c})=>{x({startX:i,startY:l,endX:f,endY:c})})}const G=new Set;function L(e,a){const t=e.targetRef.deref();if(!t||!e.options.event)return;const s=e.options.event.pointerId;G.has(s)||(G.add(s),t.setPointerCapture(e.options.event.pointerId));const d=ht(e,a);t.addEventListener("pointermove",d);const o=h=>{const n=e.targetRef.deref();n==null||n.releasePointerCapture(h.pointerId),G.delete(h.pointerId),n==null||n.removeEventListener("pointermove",d),n==null||n.removeEventListener("pointerup",o),n==null||n.removeEventListener("pointercancel",o)};t.addEventListener("pointerup",o),t.addEventListener("pointercancel",o)}function ht(e,a){const{scaleX:t,scaleY:s,rotate:d}=e.domAttrs.transform,o=e.options.event.clientX,h=e.options.event.clientY;if(d){const n=-d*Math.PI/180,g=o*Math.cos(n)-h*Math.sin(n),x=o*Math.sin(n)+h*Math.cos(n),i=g/t,f=x/s;return l=>{const c=l.clientX,r=l.clientY,u=c*Math.cos(n)-r*Math.sin(n),m=c*Math.sin(n)+r*Math.cos(n),Y=u/t,S=m/s;a({startX:i,endX:Y,startY:f,endY:S})}}else{const n=o/t,g=h/s;return x=>{const i=x.clientX/t,f=x.clientY/s;a({startX:n,endX:i,startY:g,endY:f})}}}function dt(e){if(!e.target||!e.direction)return;const a=st(e);nt(a),at(a)}export{dt as f};
