var V=Object.defineProperty;var $=(n,t,e)=>t in n?V(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var p=(n,t,e)=>$(n,typeof t!="symbol"?t+"":t,e);import{d as S,p as R,c as w,o as T,j as m,af as y,ak as P,a as b,al as C,Z as D,F as H,_ as I}from"./framework.DraZOub8.js";import{f as E,r as f,c as B}from"./update-style.Csv_yF-P.js";function U(n){if(!n.rotateParams.manualRotate)return;const{rotateParams:t,rotateHandler:e,rotateAngle:o,rotateStyleUpdater:r}=n,a=o.total,i=e.rotating(t.manualRotate+a);if(!o.angle)return;const s=r.setStyleRotate(i);n.updateRotate({rotate:i},s)}function k(n){if(!n.options.pointer)return;const t=X(n),e=n.rotateAngle.total;return Y(n,({startX:o,endX:r,startY:a,endY:i})=>{const{rotateHandler:s,rotateAngle:h,rotateStyleUpdater:c}=n,l=t.x-(o-r),u=t.y-(a-i),d=Math.atan2(u,l)*(180/Math.PI),g=s.rotating(d-t.deg+e);if(!h.angle)return;const v=c.setStyleRotate(g);n.updateRotate({rotate:g},v)})}function X(n){if(!n.options.target||!n.options.pointer)return{x:0,y:0,deg:0};const{rotateDomAttrs:t}=n,e=(o,r)=>{const a=n.options.pointer.clientX-o,i=n.options.pointer.clientY-r,s=Math.atan2(i,a)*(180/Math.PI);return{x:a,y:i,deg:s}};if(t.variant.transformOriginX===.5&&t.variant.transformOriginY===.5){const o=n.options.target.getBoundingClientRect(),r=o.left+o.width/2,a=o.top+o.height/2;return e(r,a)}else{const o=n.options.target.getBoundingClientRect(),r=t.variant.rotate%360;let a=r;r>180?a=r-360:r<-180&&(a=r+360);const i=Math.abs(a),{x:s,y:h}=t.variant.originPosition,c=(i>90?180-i:i)*Math.PI/180,l=Math.sin(c),u=Math.cos(c);let d=0,g=0;return i>90&&a<0?(d=o.right-s*u-(t.domHeight-h)*l,g=o.bottom-s*l-h*u):i>=90&&a>=0?(d=o.right-s*u-h*l,g=o.top+s*l+(t.domHeight-h)*u):i<90&&a>0?(d=o.left+s*u+(t.domHeight-h)*l,g=o.top+s*l+h*u):i<=90&&a<=0&&(d=o.left+s*u+h*l,g=o.bottom-s*l-(t.domHeight-h)*u),e(d,g)}}const x=new Set;function Y(n,t){const{options:e}=n;if(!e.pointer)return;const o=e.pointerTarget||e.target||document.body,r=new WeakRef(o),a=e.pointer.pointerId;x.has(a)||(x.add(a),o.setPointerCapture(e.pointer.pointerId)),n.onPointerBegin();const i=e.pointer.clientX,s=e.pointer.clientY,h=l=>{const u=l.clientX,d=l.clientY;t({startX:i,endX:u,startY:s,endY:d}),n.onPointerMove()};o.addEventListener("pointermove",h);const c=()=>{const l=r.deref();l==null||l.releasePointerCapture(a),x.delete(a),l==null||l.removeEventListener("pointermove",h),l==null||l.removeEventListener("pointerup",c),l==null||l.removeEventListener("pointercancel",c),n.clearPointer(),n.onPointerEnd()};return e.disablePointerEnd||(o.addEventListener("pointerup",c),o.addEventListener("pointercancel",c)),c}class z{constructor(t){p(this,"value",0);p(this,"total",0);p(this,"angle",0);this.rotateDomAttrs=t,this.value=this.rotateDomAttrs.originRotate}logAngle(t){this.angle=t-this.value,this.total=t-this.rotateDomAttrs.originRotate,this.value=t}}let L=class{constructor(t){p(this,"variant",new E);p(this,"domHeight",0);p(this,"originRotate",0);p(this,"minRotate",-1/0);p(this,"maxRotate",1/0);this.options=t,this.updateTargetAttrsInfo(),this.updateRotateInfo(),this.customDomAttrs()}updateTargetAttrsInfo(){if(!this.options.target)return;const t=window.getComputedStyle(this.options.target,null);this.variant.setTransform(t),this.variant.setRotate(t),this.variant.setScale(t),this.variant.setTransformOrigin(t),this.domHeight=f(t.height)}updateRotateInfo(){this.options.rotateType==="transform"?this.originRotate=this.variant.transformRotate:this.originRotate=this.variant.styleRotate}customDomAttrs(){if(!this.options.customStyle)return;const{rotate:t,maxRotate:e,minRotate:o}=this.options.customStyle;t!==void 0&&(this.originRotate=f(String(t))),o!==void 0&&(this.minRotate=f(String(o))),e!==void 0&&(this.maxRotate=f(String(e)))}},_=class{constructor(t,e,o){p(this,"getRotateValue",t=>t);this.options=t,this.rotateParams=e,this.rotateAngle=o,this.createRotateValueMethod()}createRotateValueMethod(){this.getRotateValue=this.options.step&&this.options.step>0?t=>Math.round(t/this.options.step)*this.options.step:t=>t}rotating(t){const{minValue:e,maxValue:o,originValue:r}=this.rotateParams;let a=this.getRotateValue(t);return a<e?a=e:a>o&&(a=o),a+=r,this.rotateAngle.logAngle(a),a}};class N{constructor(t,e){p(this,"manualRotate",0);p(this,"originValue",0);p(this,"minValue",-1/0);p(this,"maxValue",1/0);this.options=t,this.domRotateAttrs=e,this.setManualDeg(),this.setParams()}setManualDeg(){var o,r,a;const t=(r=(o=this.options.manual)==null?void 0:o.rotate)==null?void 0:r.toString();let e=0;t&&(e=f(t),((a=this.options.manual)==null?void 0:a.mode)==="absolute"&&(e=e-this.domRotateAttrs.variant.rotate)),this.manualRotate=e}setParams(){const{variant:t,maxRotate:e,minRotate:o,originRotate:r}=this.domRotateAttrs;this.originValue=r%360;let a=t.rotate%360;Math.abs(a)>180&&(a=a<0?360-a:a-360);const i=this.options.step;i&&i>0?(this.minValue=Math.ceil((o-a)/i)*i,this.maxValue=Math.floor((e-a)/i)*i):(this.minValue=o-a,this.maxValue=e-a)}}class j{constructor(t,e){p(this,"targetRef");p(this,"setStyleRotate",()=>({}));this.options=t,this.rotateDomAttrs=e,t.target&&(this.targetRef=new WeakRef(t.target)),this.setStyleRotateUpdater()}setStyleRotateUpdater(){this.setStyleRotate=B(this.createRotateHandler(),this.targetRef,this.options.disableUpdate)}changeByCustomRender(t){return e=>{var r;const o=(r=this.options.customRender)==null?void 0:r[t];return(o==null?void 0:o(e))??`${e}deg`}}createRotateHandler(){const t=this.changeByCustomRender("rotate");if(this.options.rotateType==="transform"){const{transformName:e,transformValue:o,transformScaleX:r,transformScaleY:a}=this.rotateDomAttrs.variant;let i="";const s=o.length>6;return s?i=`,${o.slice(6).join(",")}`:i=`${o.slice(4).join(",")}`,h=>{const c=Math.cos(h*Math.PI/180),l=Math.sin(h*Math.PI/180),u=c*r,d=l*r,g=-l*a,v=c*a,M=s?`${u},${d},${o[2]},${o[3]},${g},${v}`:`${u},${d},${g},${v}`;return{transform:`${e}(${M},${i})`}}}else return e=>({rotate:t(e)})}}class O{constructor(t){p(this,"options",{});p(this,"rotateDomAttrs");p(this,"rotateParams");p(this,"rotateAngle");p(this,"rotateStyleUpdater");p(this,"rotateHandler");p(this,"cacheResizeContent",{});t&&(this.options=t),this.rotateDomAttrs=new L(this.options),this.rotateParams=new N(this.options,this.rotateDomAttrs),this.rotateAngle=new z(this.rotateDomAttrs),this.rotateStyleUpdater=new j(this.options,this.rotateDomAttrs),this.rotateHandler=new _(this.options,this.rotateParams,this.rotateAngle)}clearPointer(){this.options.pointer=void 0}updateRotate(t,e){var o,r;this.cacheResizeContent=t,(r=(o=this.options).callback)==null||r.call(o,t,e)}onPointerBegin(){var t,e;this.cacheResizeContent={rotate:this.rotateDomAttrs.originRotate},(e=(t=this.options).onPointerBegin)==null||e.call(t,this.cacheResizeContent)}onPointerMove(){var t,e;(e=(t=this.options).onPointerMove)==null||e.call(t,this.cacheResizeContent)}onPointerEnd(){var t,e;(e=(t=this.options).onPointerEnd)==null||e.call(t,this.cacheResizeContent)}}function A(n){const t=new O(n);return U(t),k(t)}const F={class:"flex gap-1 mt-4"},W={class:"flex gap-1 mt-4"},Z={class:"flex flex-wrap gap-1 mt-4"},q={class:"flex gap-1 items-center justify-center"},G={class:"position-relative h-100"},J=S({__name:"base",setup(n){const t=R(),e=R("rotate"),o=R();function r(i){A({target:t.value,pointer:i,step:Number(o.value)||void 0,rotateType:e.value})}function a(i){A({target:t.value,manual:{rotate:i},step:Number(o.value)||void 0,rotateType:e.value})}return(i,s)=>(T(),w(H,null,[m("div",F,[m("div",null,[y(m("input",{id:"rotate","onUpdate:modelValue":s[0]||(s[0]=h=>e.value=h),type:"radio",name:"rotateType",value:"rotate",class:"mb-[3px]"},null,512),[[P,e.value]]),s[5]||(s[5]=m("label",{for:"rotate"},"rotate",-1))]),m("div",null,[y(m("input",{id:"transform","onUpdate:modelValue":s[1]||(s[1]=h=>e.value=h),type:"radio",name:"rotateType",value:"transform",class:"mb-[3px]"},null,512),[[P,e.value]]),s[6]||(s[6]=m("label",{for:"transform"},"transform",-1))])]),m("div",W,[s[7]||(s[7]=b(" step: ",-1)),y(m("input",{"onUpdate:modelValue":s[2]||(s[2]=h=>o.value=h),class:"b-1 b-gray b-solid px-1 b-rounded"},null,512),[[C,o.value]])]),m("div",Z,[m("div",q,[m("button",{class:"ctxs-btn",onClick:s[3]||(s[3]=h=>a(-5))}," -5 "),s[8]||(s[8]=b(" 调整 ",-1)),m("button",{class:"ctxs-btn",onClick:s[4]||(s[4]=h=>a(5))}," +5 ")])]),m("div",G,[m("div",{ref_key:"rotateTarget1",ref:t,class:"w-60 h-30 position-absolute bg-blue min-w-10 min-h-10 max-w-100 left-[200px] max-h-100 top-[200px]",onPointerdown:D(r,["stop","prevent"])},null,544)])],64))}}),at=I(J,[["__scopeId","data-v-4b7fd0d7"]]);export{at as default};
