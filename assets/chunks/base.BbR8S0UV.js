var S=Object.defineProperty;var w=(s,t,e)=>t in s?S(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var h=(s,t,e)=>w(s,typeof t!="symbol"?t+"":t,e);import{d as $,p as R,c as T,o as A,a as y,j as m,af as P,ak as b,al as C,Z as L,F as D,_ as I}from"./framework.DraZOub8.js";import{f as E,n as f,a as B,c as H}from"./update-style.Di614ZlN.js";function U(s){if(!s.rotateParams.manualRotate)return;const{rotateParams:t,rotateHandler:e,rotateLogger:o,rotateStyleUpdater:i}=s,a=o.total,r=e.rotating(t.manualRotate+a);if(!o.angle)return;const n=i.setStyleRotate(r);s.updateRotate({rotate:r},n)}function k(s){if(!s.options.pointer)return;const t=X(s),e=s.rotateLogger.total;return Y(s,({startX:o,endX:i,startY:a,endY:r})=>{const{rotateHandler:n,rotateLogger:u,rotateStyleUpdater:c}=s,l=t.x-(o-i),p=t.y-(a-r),d=Math.atan2(p,l)*(180/Math.PI),g=n.rotating(d-t.deg+e);if(!u.angle)return;const v=c.setStyleRotate(g);s.updateRotate({rotate:g},v)})}function X(s){if(!s.options.target||!s.options.pointer)return{x:0,y:0,deg:0};const{rotateDomAttrs:t}=s,e=(o,i)=>{const a=s.options.pointer.clientX-o,r=s.options.pointer.clientY-i,n=Math.atan2(r,a)*(180/Math.PI);return{x:a,y:r,deg:n}};if(t.variant.transformOriginX===.5&&t.variant.transformOriginY===.5){const o=s.options.target.getBoundingClientRect(),i=o.left+o.width/2,a=o.top+o.height/2;return e(i,a)}else{const o=s.options.target.getBoundingClientRect(),i=t.variant.rotate%360;let a=i;i>180?a=i-360:i<-180&&(a=i+360);const r=Math.abs(a),{x:n,y:u}=t.variant.originPosition,c=(r>90?180-r:r)*Math.PI/180,l=Math.sin(c),p=Math.cos(c);let d=0,g=0;return r>90&&a<0?(d=o.right-n*p-(t.domHeight-u)*l,g=o.bottom-n*l-u*p):r>=90&&a>=0?(d=o.right-n*p-u*l,g=o.top+n*l+(t.domHeight-u)*p):r<90&&a>0?(d=o.left+n*p+(t.domHeight-u)*l,g=o.top+n*l+u*p):r<=90&&a<=0&&(d=o.left+n*p+u*l,g=o.bottom-n*l-(t.domHeight-u)*p),e(d,g)}}const x=new Set;function Y(s,t){const{options:e}=s;if(!e.pointer)return;const o=e.pointerTarget||e.target||document.body,i=new WeakRef(o),a=e.pointer.pointerId;x.has(a)||(x.add(a),o.setPointerCapture(e.pointer.pointerId)),s.onPointerBegin();const r=e.pointer.clientX,n=e.pointer.clientY,u=l=>{const p=l.clientX,d=l.clientY;t({startX:r,endX:p,startY:n,endY:d}),s.onPointerMove()};o.addEventListener("pointermove",u);const c=()=>{const l=i.deref();l==null||l.releasePointerCapture(a),x.delete(a),l==null||l.removeEventListener("pointermove",u),l==null||l.removeEventListener("pointerup",c),l==null||l.removeEventListener("pointercancel",c),s.clearPointer(),s.onPointerEnd()};return e.disablePointerEnd||(o.addEventListener("pointerup",c),o.addEventListener("pointercancel",c)),c}let N=class{constructor(t){h(this,"variant",new E);h(this,"domHeight",0);h(this,"originRotate",0);h(this,"minRotate",-1/0);h(this,"maxRotate",1/0);this.options=t,this.updateTargetAttrsInfo(),this.updateRotateInfo(),this.customDomAttrs()}updateTargetAttrsInfo(){if(!this.options.target)return;const t=window.getComputedStyle(this.options.target,null);this.variant.setTransform(t),this.variant.setRotate(t),this.variant.setScale(t),this.variant.setTransformOrigin(t),this.domHeight=f(t.height)}updateRotateInfo(){this.options.rotateType==="transform"?this.originRotate=this.variant.transformRotate:this.originRotate=this.variant.styleRotate}customDomAttrs(){if(!this.options.customStyle)return;const{rotate:t,maxRotate:e,minRotate:o}=this.options.customStyle;t!==void 0&&(this.originRotate=f(String(t))),o!==void 0&&(this.minRotate=f(String(o))),e!==void 0&&(this.maxRotate=f(String(e)))}};class j{constructor(t,e,o){h(this,"getRotateValue",t=>t);this.options=t,this.rotateParams=e,this.rotateLogger=o,this.createRotateValueMethod()}createRotateValueMethod(){this.getRotateValue=this.options.step&&this.options.step>0?t=>Math.round(t/this.options.step)*this.options.step:t=>t}rotating(t){const{minValue:e,maxValue:o,originValue:i}=this.rotateParams;let a=this.getRotateValue(t);return a<e?a=e:a>o&&(a=o),a=B(a+i),this.rotateLogger.logAngle(a),a}}class _{constructor(t){h(this,"value",0);h(this,"total",0);h(this,"angle",0);this.rotateParams=t,this.value=this.rotateParams.originValue}logAngle(t){this.angle=t-this.value,this.total=t-this.rotateParams.originValue,this.value=t}}class O{constructor(t,e){h(this,"manualRotate",0);h(this,"originValue",0);h(this,"minValue",-1/0);h(this,"maxValue",1/0);this.options=t,this.domRotateAttrs=e,this.setManualDeg(),this.setParams()}setManualDeg(){var t,e;if(((t=this.options.manual)==null?void 0:t.rotate)!==void 0){let o=f(this.options.manual.rotate.toString());((e=this.options.manual)==null?void 0:e.mode)==="absolute"&&(o=o-this.domRotateAttrs.variant.rotate),this.manualRotate=o}else this.manualRotate=0}setParams(){const{variant:t,maxRotate:e,minRotate:o,originRotate:i}=this.domRotateAttrs;this.originValue=i%360;let a=t.rotate%360;Math.abs(a)>180&&(a=a<0?360-a:a-360);const r=this.options.step;r&&r>0?(this.minValue=Math.ceil((o-a)/r)*r,this.maxValue=Math.floor((e-a)/r)*r):(this.minValue=o-a,this.maxValue=e-a)}}class F{constructor(t,e){h(this,"targetRef");h(this,"setStyleRotate",()=>({}));this.options=t,this.rotateDomAttrs=e,t.target&&(this.targetRef=new WeakRef(t.target)),this.setStyleRotateUpdater()}setStyleRotateUpdater(){this.setStyleRotate=H(this.createGetRotateStyle(),this.targetRef,this.options.disableUpdate)}changeByCustomRender(t){return e=>{var i;const o=(i=this.options.customRender)==null?void 0:i[t];return(o==null?void 0:o(e))??`${e}deg`}}createGetRotateStyle(){const t=this.changeByCustomRender("rotate");if(this.options.rotateType==="transform"){const{transformName:e,transformValue:o,transformScaleX:i,transformScaleY:a}=this.rotateDomAttrs.variant;let r="";const n=o.length>6;return n?r=o.slice(6).join(","):r=o.slice(4).join(","),u=>{const c=Math.cos(u*Math.PI/180),l=Math.sin(u*Math.PI/180),p=c*i,d=l*i,g=-l*a,v=c*a,V=n?`${p},${d},${o[2]},${o[3]},${g},${v}`:`${p},${d},${g},${v}`;return{transform:`${e}(${V},${r})`}}}else return e=>({rotate:t(e)})}}class G{constructor(t){h(this,"options",{});h(this,"rotateDomAttrs");h(this,"rotateParams");h(this,"rotateLogger");h(this,"rotateStyleUpdater");h(this,"rotateHandler");h(this,"cacheRotateContent",{});t&&(this.options=t),this.rotateDomAttrs=new N(this.options),this.rotateParams=new O(this.options,this.rotateDomAttrs),this.rotateLogger=new _(this.rotateParams),this.rotateStyleUpdater=new F(this.options,this.rotateDomAttrs),this.rotateHandler=new j(this.options,this.rotateParams,this.rotateLogger)}clearPointer(){this.options.pointer=void 0}updateRotate(t,e){var o,i;this.cacheRotateContent=t,(i=(o=this.options).callback)==null||i.call(o,t,e)}onPointerBegin(){var t,e;this.cacheRotateContent={rotate:this.rotateDomAttrs.originRotate},(e=(t=this.options).onPointerBegin)==null||e.call(t,this.cacheRotateContent)}onPointerMove(){var t,e;(e=(t=this.options).onPointerMove)==null||e.call(t,this.cacheRotateContent)}onPointerEnd(){var t,e;(e=(t=this.options).onPointerEnd)==null||e.call(t,this.cacheRotateContent)}}function M(s){const t=new G(s);return U(t),k(t)}const W={class:"flex gap-1 mt-4"},Z={class:"flex gap-1 mt-4"},q={class:"flex flex-wrap gap-1 mt-4"},z={class:"flex gap-1 items-center justify-center"},J={class:"position-relative h-100"},K=$({__name:"base",setup(s){const t=R(),e=R("rotate"),o=R();function i(r){M({target:t.value,pointer:r,step:Number(o.value)||void 0,rotateType:e.value})}function a(r){M({target:t.value,manual:{rotate:r},step:Number(o.value)||void 0,rotateType:e.value})}return(r,n)=>(A(),T(D,null,[n[9]||(n[9]=y(" 使用指针拖动旋转 ",-1)),m("div",W,[m("div",null,[P(m("input",{id:"rotate","onUpdate:modelValue":n[0]||(n[0]=u=>e.value=u),type:"radio",name:"rotateType",value:"rotate",class:"mb-[3px]"},null,512),[[b,e.value]]),n[5]||(n[5]=m("label",{for:"rotate"},"rotate",-1))]),m("div",null,[P(m("input",{id:"transform","onUpdate:modelValue":n[1]||(n[1]=u=>e.value=u),type:"radio",name:"rotateType",value:"transform",class:"mb-[3px]"},null,512),[[b,e.value]]),n[6]||(n[6]=m("label",{for:"transform"},"transform",-1))])]),m("div",Z,[n[7]||(n[7]=y(" step: ",-1)),P(m("input",{"onUpdate:modelValue":n[2]||(n[2]=u=>o.value=u),class:"b-1 b-gray b-solid px-1 b-rounded"},null,512),[[C,o.value]])]),m("div",q,[m("div",z,[m("button",{class:"ctxs-btn",onClick:n[3]||(n[3]=u=>a(-5))}," -5 "),n[8]||(n[8]=y(" 调整 ",-1)),m("button",{class:"ctxs-btn",onClick:n[4]||(n[4]=u=>a(5))}," +5 ")])]),m("div",J,[m("div",{ref_key:"rotateTarget1",ref:t,class:"w-60 h-30 position-absolute bg-blue min-w-10 min-h-10 max-w-100 left-[200px] max-h-100 top-[200px]",onPointerdown:L(i,["stop","prevent"])},null,544)])],64))}}),at=I(K,[["__scopeId","data-v-754f56f4"]]);export{at as default};
