var V=Object.defineProperty;var $=(r,t,e)=>t in r?V(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var u=(r,t,e)=>$(r,typeof t!="symbol"?t+"":t,e);import{d as z,p as v,c as P,o as X,a as x,j as d,F as Y,B as C,af as h,ak as y,t as T,al as w,Z as L,_ as M}from"./framework.DraZOub8.js";import{o as m,f as U,c as k}from"./update-style.Di614ZlN.js";import{m as O}from"./dom-size.DsQGIV4V.js";const D=.5;let R=class{constructor(t,e){u(this,"x",{originValue:0,gridDistance:D,manualDistance:0});u(this,"y",{originValue:0,gridDistance:D,manualDistance:0});this.options=t,this.dragDomAttrs=e,this.setManualDistance(),this.setAxisParams()}setManualDistance(){var o,l;const{parentWidth:t,parentHeight:e}=this.dragDomAttrs.size,n=this.resolveManualDistance(this.x.originValue,t,(o=this.options.manual)==null?void 0:o.offsetX),i=this.resolveManualDistance(this.y.originValue,e,(l=this.options.manual)==null?void 0:l.offsetY);this.x.manualDistance=n,this.y.manualDistance=i}setAxisParams(){var n,i;const{offsetX:t,offsetY:e}=this.dragDomAttrs;this.x.originValue=t,this.y.originValue=e,this.x.gridDistance=((n=this.options.grid)==null?void 0:n[0])??D,this.y.gridDistance=((i=this.options.grid)==null?void 0:i[1])??D}resolveManualDistance(t,e,n){var l;if(n===void 0)return 0;const i=n.toString();let o=0;return i&&(o=m(i,e),((l=this.options.manual)==null?void 0:l.mode)==="absolute"&&(o=o-t)),o}},E=class{constructor(t){u(this,"offsetX",0);u(this,"offsetY",0);u(this,"variant",new U);u(this,"size",new O);this.options=t,this.updateTargetAttrsInfo(),this.updateOffsetInfo(),this.customDomAttrs()}updateTargetAttrsInfo(){if(!this.options.target)return;const t=window.getComputedStyle(this.options.target,null),e=window.getComputedStyle(this.options.target.parentNode,null);this.size.setSizeInfo(t,e),this.variant.setTransform(t),this.variant.setPosition(t),this.variant.setTranslate(t)}updateOffsetInfo(){this.options.offsetType==="transform"?this.variant.transformValue.length>6?(this.offsetX=this.variant.transformValue[12],this.offsetY=this.variant.transformValue[13]):(this.offsetX=this.variant.transformValue[4],this.offsetY=this.variant.transformValue[5]):this.options.offsetType==="translate"?(this.offsetX=this.variant.translateX,this.offsetY=this.variant.translateY):(this.offsetX=this.variant.positionLeft,this.offsetY=this.variant.positionTop)}customDomAttrs(){if(!this.options.customStyle)return;const{parentWidth:t,parentHeight:e,width:n,height:i,offsetX:o,offsetY:l}=this.options.customStyle;t!==void 0&&(this.size.parentWidth=t),e!==void 0&&(this.size.parentHeight=e),n!==void 0&&(this.size.width=m(String(n),this.size.parentWidth)),i!==void 0&&(this.size.height=m(String(i),this.size.parentHeight)),o!==void 0&&(this.offsetX=m(String(o),this.size.width)),l!==void 0&&(this.offsetY=m(String(l),this.size.height))}};class B{constructor(t,e){this.dragAxisParams=t,this.dragLogger=e}dragging(t,e,n){const{gridDistance:i,originValue:o}=this.dragAxisParams[n],l=Math.round((e-t)/i)*i,g=o+l;return this.dragLogger.logDistance(g,n),g}}class H{constructor(t){u(this,"x",{value:0,total:0,distance:0});u(this,"y",{value:0,total:0,distance:0});this.dragAxisParams=t,this.setDistance()}setDistance(){this.x.value=this.dragAxisParams.x.originValue,this.y.value=this.dragAxisParams.y.originValue,this.x.total=0,this.y.total=0,this.x.distance=0,this.y.distance=0}logDistance(t,e){this[e].distance=t-this[e].value,this[e].value=t,this[e].total=t-this.dragAxisParams[e].originValue}}let I=class{constructor(t,e){u(this,"targetRef");u(this,"setStyleOffset",()=>({}));this.options=t,this.dragDomAttrs=e,t.target&&(this.targetRef=new WeakRef(t.target)),this.setStyleOffsetUpdater()}setStyleOffsetUpdater(){this.setStyleOffset=k(this.createGetOffsetStyle(),this.targetRef,this.options.disableUpdate)}changeByCustomRender(t){return e=>{var i;const n=(i=this.options.customRender)==null?void 0:i[t];return(n==null?void 0:n(e,{parentWidth:this.dragDomAttrs.size.parentWidth,parentHeight:this.dragDomAttrs.size.parentHeight}))??`${e}px`}}createGetOffsetStyle(){if(this.options.offsetType==="transform"){const{transformName:n,transformValue:i}=this.dragDomAttrs.variant;let o="",l="";return i.length>6?(o=`${i.slice(0,12).join(",")},`,l=`,${i.slice(14).join(",")}`):(o=`${i.slice(0,4).join(",")},`,l=""),(g,f)=>({transform:`${n}(${o}${g},${f}${l})`})}const t=this.changeByCustomRender("offsetX"),e=this.changeByCustomRender("offsetY");return this.options.offsetType==="position"?(n,i)=>({left:t(n),top:e(i)}):(n,i)=>({translate:`${t(n)} ${e(i)}`})}};class W{constructor(t){u(this,"options",{});u(this,"dragDomAttrs");u(this,"dragAxisParams");u(this,"dragLogger");u(this,"dragStyleUpdater");u(this,"dragHandler");u(this,"cacheDragContent",{});t&&(this.options=t),this.dragDomAttrs=new E(this.options),this.dragAxisParams=new R(this.options,this.dragDomAttrs),this.dragLogger=new H(this.dragAxisParams),this.dragStyleUpdater=new I(this.options,this.dragDomAttrs),this.dragHandler=new B(this.dragAxisParams,this.dragLogger)}clearManual(){this.options.manual=void 0}clearPointer(){this.options.pointer=void 0}updateDrag(t,e){var n,i;this.cacheDragContent=t,(i=(n=this.options).callback)==null||i.call(n,t,e)}onPointerBegin(){var t,e;this.cacheDragContent={offsetX:this.dragDomAttrs.offsetX,offsetY:this.dragDomAttrs.offsetY},(e=(t=this.options).onPointerBegin)==null||e.call(t,this.cacheDragContent)}onPointerMove(){var t,e;(e=(t=this.options).onPointerMove)==null||e.call(t,this.cacheDragContent)}onPointerEnd(){var t,e;(e=(t=this.options).onPointerEnd)==null||e.call(t,this.cacheDragContent)}}function j(r){if(!r.dragAxisParams.x.manualDistance&&!r.dragAxisParams.y.manualDistance)return;const{options:t,dragDomAttrs:e,dragAxisParams:n,dragHandler:i,dragLogger:o,dragStyleUpdater:l}=r,g=o.x.total,f=o.y.total;let s=e.offsetX;t.direction!=="y"&&(s=i.dragging(0,n.x.manualDistance+g,"x"));let a=e.offsetY;if(t.direction!=="x"&&(a=i.dragging(0,n.y.manualDistance+f,"y")),!o.x.distance&&!o.y.distance)return;const p=l.setStyleOffset(s,a);r.updateDrag({offsetX:s,offsetY:a},p),r.clearManual()}const b=new Set;function N(r){if(!r.options.pointer)return;const{options:t,dragDomAttrs:e,dragHandler:n,dragLogger:i,dragStyleUpdater:o}=r;return t.direction==="x"?A(r,({startX:l,endX:g})=>{const f=n.dragging(l,g,"x"),s=e.offsetY;if(!i.x.distance&&!i.y.distance)return;const a=o.setStyleOffset(f,s);r.updateDrag({offsetX:f,offsetY:s},a)}):t.direction==="y"?A(r,({startY:l,endY:g})=>{const f=e.offsetX,s=n.dragging(l,g,"y");if(!i.x.distance&&!i.y.distance)return;const a=o.setStyleOffset(f,s);r.updateDrag({offsetX:f,offsetY:s},a)}):A(r,({startX:l,endX:g,startY:f,endY:s})=>{const a=n.dragging(l,g,"x"),p=n.dragging(f,s,"y");if(!i.x.distance&&!i.y.distance)return;const c=o.setStyleOffset(a,p);r.updateDrag({offsetX:a,offsetY:p},c)})}function A(r,t){const{options:e}=r;if(!e.pointer)return;const n=e.pointerTarget||e.target||document.body,i=new WeakRef(n),o=e.pointer.pointerId;b.has(o)||(b.add(o),n.setPointerCapture(e.pointer.pointerId)),r.onPointerBegin();const l=e.pointer.clientX,g=e.pointer.clientY,f=a=>{const p=a.clientX,c=a.clientY;t({startX:l,endX:p,startY:g,endY:c}),r.onPointerMove()};n.addEventListener("pointermove",f);const s=()=>{const a=i.deref();a==null||a.releasePointerCapture(o),b.delete(o),a==null||a.removeEventListener("pointermove",f),a==null||a.removeEventListener("pointerup",s),a==null||a.removeEventListener("pointercancel",s),r.clearPointer(),r.onPointerEnd()};return e.disablePointerEnd||(n.addEventListener("pointerup",s),n.addEventListener("pointercancel",s)),s}function S(r){const t=new W(r);return j(t),N(t)}const F={class:"flex flex-wrap gap-1 mt-4"},G=["id","value"],Z=["for"],q={class:"flex gap-1 mt-4"},J={class:"flex gap-1 mt-4"},K={class:"flex mt-4 items-center justify-center flex-col w-40"},Q={class:"flex gap-1 items-center justify-center"},_={class:"position-relative h-100"},tt=z({__name:"base",setup(r){const t=v(),e=["all","x","y"],n=v(e[0]),i=v("position"),o=v([.5,.5]);function l(f){S({target:t.value,pointer:f,offsetType:i.value,direction:n.value,grid:o.value,manual:void 0})}function g(f){S({target:t.value,offsetType:i.value,direction:n.value,grid:o.value,manual:{offsetX:f.x,offsetY:f.y}})}return(f,s)=>(X(),P(Y,null,[s[16]||(s[16]=x(" 使用指针拖动调整位置 ",-1)),d("div",F,[(X(),P(Y,null,C(e,(a,p)=>d("div",{key:a},[h(d("input",{id:`dir${p}`,"onUpdate:modelValue":s[0]||(s[0]=c=>n.value=c),type:"radio",name:"direction",value:a,class:"mb-[3px]"},null,8,G),[[y,n.value]]),d("label",{for:`dir${p}`},T(a),9,Z)])),64))]),d("div",q,[d("div",null,[h(d("input",{id:"position","onUpdate:modelValue":s[1]||(s[1]=a=>i.value=a),type:"radio",name:"offset",value:"position",class:"mb-[3px]"},null,512),[[y,i.value]]),s[10]||(s[10]=d("label",{for:"position"},"position",-1))]),d("div",null,[h(d("input",{id:"transform","onUpdate:modelValue":s[2]||(s[2]=a=>i.value=a),type:"radio",name:"offset",value:"transform",class:"mb-[3px]"},null,512),[[y,i.value]]),s[11]||(s[11]=d("label",{for:"transform"},"transform",-1))]),d("div",null,[h(d("input",{id:"translate","onUpdate:modelValue":s[3]||(s[3]=a=>i.value=a),type:"radio",name:"offset",value:"translate",class:"mb-[3px]"},null,512),[[y,i.value]]),s[12]||(s[12]=d("label",{for:"translate"},"translate",-1))])]),d("div",J,[s[13]||(s[13]=x(" gridX: ",-1)),h(d("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>o.value[0]=a),class:"b-1 b-gray b-solid px-1 b-rounded"},null,512),[[w,o.value[0]]]),s[14]||(s[14]=x(" gridY: ",-1)),h(d("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>o.value[1]=a),class:"b-1 b-gray b-solid b-rounded px-1"},null,512),[[w,o.value[1]]])]),d("div",K,[d("button",{class:"ctxs-btn",onClick:s[6]||(s[6]=a=>g({x:0,y:-5}))}," -5 "),d("div",Q,[d("button",{class:"ctxs-btn",onClick:s[7]||(s[7]=a=>g({x:-5,y:0}))}," -5 "),s[15]||(s[15]=x(" 调整 ",-1)),d("button",{class:"ctxs-btn",onClick:s[8]||(s[8]=a=>g({x:5,y:0}))}," +5 ")]),d("button",{class:"ctxs-btn",onClick:s[9]||(s[9]=a=>g({x:0,y:5}))}," +5 ")]),d("div",_,[d("div",{ref_key:"resizeTarget1",ref:t,class:"w-30 h-30 position-absolute bg-blue min-w-10 min-h-10 max-w-100 left-[200px] max-h-100 top-[200px]",onPointerdown:L(l,["stop","prevent"])},null,544)])],64))}}),lt=M(tt,[["__scopeId","data-v-06453fdb"]]);export{lt as default};
